// ========================================================================================================
// LIBRARY
// ========================================================================================================
import express from "express";
import cors from "cors";


// ========================================================================================================
// CONFIGURATION
// ========================================================================================================
import logger from "./config/logger.js";


// ========================================================================================================
// CONFIGURATION
// ========================================================================================================
import HalloController from "./src/hallo/hallo.controller.js";
import AuthController from "./src/auth/auth.controller.js";
import UserController from "./src/users/users.controller.js";


// ========================================================================================================
// INITIALIZE
// ========================================================================================================
const app = express();


// ========================================================================================================
// MIDDLEWARE
// ========================================================================================================
app.use(cors());
app.use(express.json());
app.use(express.urlencoded({ extended: true }));


// ========================================================================================================
// ROUTES
// ========================================================================================================
app.use("/", HalloController);
app.use("/api/auth", AuthController);
app.use("/api/users", UserController);


// ========================================================================================================
// ERROR HANDLER
// ========================================================================================================
app.use((err, req, res, next) => {
    let formattedError;
    if (err.issues) {
        formattedError = err.issues.map(issue => ({
            code: issue.code,
            path: issue.path,
            message: issue.message
        }));
    } else {
        formattedError = { message: err.message };
    }
    return res.status(err.status || 500).json(formattedError);
});


// ========================================================================================================
// SERVER LISTEN
// ========================================================================================================
app.listen(process.env.APP_PORT || 3000, () => {
    logger.info(`Server is running on port ${process.env.APP_PORT || 3000}`);
})